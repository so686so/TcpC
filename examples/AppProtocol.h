/**
 * 파일명: examples/AppProtocol.h
 *
 * 개요:
 * 서버와 클라이언트가 공유하는 비즈니스 데이터 구조체 및 상수 정의.
 */

#ifndef APP_PROTOCOL_H
#define APP_PROTOCOL_H

#include <stdint.h> // uint64_t, int (플랫폼 독립적 정수 타입)

// --------------------------------------------------------------------------
// 0. 타겟 코드 상수 정의 (Magic String 방지)
// --------------------------------------------------------------------------
// 주의: CommonDef.h 의 TARGET_NAME_LEN (7+1) 길이를 넘지 않아야 함.
//       이 때 마지막 단어는 '\0' 이어야 하므로, 실제로는 7글자 이하여야 함.

#define TARGET_APP_LOGIN "LOGIN"   // 로그인 요청
#define TARGET_APP_CHAT  "CHAT"    // 채팅 메시지


// --------------------------------------------------------------------------
// 구조체 정렬 설정
// --------------------------------------------------------------------------
#pragma pack(push, 1)

/** NOTE ( 매우 중요! )
 *
 * Tcp 통신에서 구조체를 송신하기 위해서는 ( Raw Struct Transmission )
 * 1. 해당 구조체가 패딩 없이 1바이트 정렬이 되어야 하고,
 * 2. 구조체 내부에 주소 정보가 없이 값 정보만으로 이루어져야 한다.
 *
 * 만약 '#pragma pack(push, 1)' 명령으로 1바이트 정렬(패딩 제거)를 하지 않는다면
 * 패킷 송/수신 시 패킷에 의도하지 않은 패딩이 생겨 파싱이 이상하게 될 수 있다.
 *
 * 만약 구조체 내부에 포인터 값이 있다면,
 * 해당 포인터는 내 컴퓨터+프로그램에서만 유효한 '주소값'이기 때문에
 * 서버나 다른 클라이언트에서는 아예 무의미한 쓰레기값밖에 되지 않는다.
 */

// --------------------------------------------------------------------------
// 1. 로그인 요청 (Client -> Server)
// 타겟: TARGET_APP_LOGIN
// --------------------------------------------------------------------------
typedef struct
{
    char user_id[32];
    char password[48];
    int  version;
} LoginReqPacket;

// --------------------------------------------------------------------------
// 2. 채팅 메시지 (Client <-> Server)
// 타겟: TARGET_APP_CHAT
// --------------------------------------------------------------------------
typedef struct
{
    char sender_id[32];
    char message[128];
    uint64_t timestamp;
} ChatPacket;

#pragma pack(pop)

#endif // APP_PROTOCOL_H